#!/usr/bin/env python2.7

"""
@author: Yochem van Rosmalen
@date: 2018/09/12

Wallpaper - Change background to an image from a given folder.

Usage:
    wallpaper.py [ARGS]
    
Examples
    wallpaper.py
        choose two random images from the folder as wallpaper for desktop 1 and
        desktop 2.

    wallpaper.py bg1.jpg bg2.jpg
        use bg1.jpg as wallpaper for desktop 1 and bg2.jpg as wallpaper for
        desktop 2.

    wallpaper.py bg1.jpg
        use given image as wallpaper on every desktop
"""

import glob
import os
import random
import sys
from subprocess import Popen, PIPE

folder = "/Users/Yochem/drive/assets/backgrounds/stalenhag/"

def choose_image():
    imgs = glob.glob(folder + "*")
    new_img = random.choice(imgs)
    return new_img

def set_background(desktop, bgimg):
    set_bg = ("osascript -e 'tell application \"System Events\" "
        "to set picture of {} to \"{}\"'".format(desktop, bgimg))

    os.system(set_bg)
	
def desktop_count():
    get_desktop = ("""tell application \"System Events\"
                   set n to count of desktops
                   end tell
                   return n
                   """)
    proc = Popen(['osascript', '-'], stdin=PIPE, stdout=PIPE)
    count,error = proc.communicate(get_desktop)
    return int(count[:1])


def main():
    desktop_count()
    if sys.platform != 'darwin':
        return 1
    if len(sys.argv) == 1:
        set_background('desktop 1', choose_image())
        if (desktop_count() == 2):
            set_background('desktop 2', choose_image())
    elif len(sys.argv) == 2:
        set_background('every desktop', folder + sys.argv[1])
    elif len(sys.argv) == 3:
        set_background('desktop 1', sys.argv[1])
        set_background('desktop 2', sys.argv[2])

if __name__ == "__main__":
    main()

#!/usr/bin/env bash

# Some colors to use for prompt
if tput setaf 1 &>/dev/null; then
    reset="\[$(tput sgr0)\]"
    green="\[$(tput setaf 2)\]"
    magenta="\[$(tput setaf 5)\]"
    blue="\[$(tput setaf 75)\]"
    red="\[$(tput setaf 2)\]"
else
    reset="\[\e[0m\]"
    green="\[\033[01;38;5;002m\]"
    magenta="\[\033[01;38;5;005m\]"
    blue="\[\033[01;38;5;006m\]"
    red="\[\033[01;38;5;031\]"
fi

# red brackets if user is root
if [[ "$USER" == "root" ]]; then
    $bracketcolor="$red"
fi

# check if git rpo and which branch
prompt_git() {
    git rev-parse --is-inside-work-tree &>/dev/null
    if [ $? == '0' ]; then
	# Get the short symbolic ref.
	# If HEAD isnt a symbolic ref, get the short SHA for the latest commit
	# Otherwise, just give up.
	branchName="$(git symbolic-ref --quiet --short HEAD 2> /dev/null || \
	    git rev-parse --short HEAD 2> /dev/null || \
	    echo -e '(unknown)')"
	echo -e "($1$branchName$2) "
    else
	return
    fi
}

# build prompt
PS1="$reset"
PS1+="$bracketcolor"
PS1+="[ "
PS1+="$reset"
# if connected using SSH, show hostname
[ -n "$SSH_CLIENT" ] && PS1+="$magenta@\h$reset: "
PS1+="$blue"
PS1+="\w " # full path of cwd
PS1+="$reset"
PS1+="\$(prompt_git \"$green\" \"$reset\")" # show git branch
PS1+="$reset"
PS1+="$bracketcolor"
PS1+="] "
export PS1

# adding color to default PS2
export PS2="$reset$blue>$reset "
